import{r as C,j as e,H,L as M,a as b}from"./app-DMN8c6vm.js";import{H as A,F as G}from"./Footer-YZHroJB1.js";import{T as U}from"./index-D1gX700H.js";import{C as N}from"./index-BW0nI5-Z.js";import{R as _,C as c}from"./row-DVRh59_D.js";import{I as W}from"./index-BJbHgQL4.js";import{R}from"./SearchOutlined-Bw3R2GAy.js";import{S as o}from"./index-DlinHlIe.js";import{R as L}from"./AimOutlined-Dq-SbNRr.js";import{B as u}from"./index-C8zb2_mb.js";import{R as v}from"./EnvironmentOutlined-B9ADwMvQ.js";import{E}from"./index-C9dSZvy0.js";import{A as F}from"./index-XI1aNo4t.js";import{R as B}from"./UserOutlined-CT6efwaX.js";import{T as I}from"./index-C6Z83uG0.js";import{R as V}from"./MedicineBoxOutlined-DXXWY55O.js";import{R as q}from"./GlobalOutlined-BSuUZhuv.js";import{P as J}from"./Pagination-CiX7KHE1.js";import{s as x}from"./index-CSDSX5qQ.js";import"./index-Bu-4_bOu.js";import"./PhoneOutlined-B7FG_llU.js";import"./MailOutlined-BbSIDTAw.js";import"./TwitterOutlined-BXdpzYVf.js";import"./EditOutlined-CeK_2jGo.js";import"./TextArea-C7pLIYAL.js";import"./getAllowClear-Cscf5q2u.js";import"./CloseCircleFilled-CU0jELYL.js";import"./index-JZqEhivI.js";import"./CheckOutlined-Bo5eQYpK.js";import"./Input-0vkbORzU.js";import"./EyeOutlined-CgG6LajU.js";import"./DownOutlined-CPNtPKBg.js";import"./index-2stbQ4d-.js";import"./CheckCircleFilled-Uof9tbt-.js";import"./ExclamationCircleFilled-DEw8Iq-9.js";import"./InfoCircleFilled-upCt2sjR.js";import"./CSSMotionList-B-ThN6IY.js";const{Title:P}=U;function $e({auth:$,doctors:m,cities:d,specialties:z,filters:i}){const[a,n]=C.useState({search:i.search||"",city:i.city||null,city_name:i.city_name||"",specialty:i.specialty||null,available_online:i.available_online||!1,sort:i.sort||"name"}),[l,r]=C.useState(i.city_name||""),[S,f]=C.useState(!1);C.useEffect(()=>{if(i.city_name){r(i.city_name);const s=d.find(t=>t.name.toLowerCase()===i.city_name.toLowerCase());s&&!i.city&&n(t=>({...t,city:s.id}))}else if(i.city){const s=d.find(t=>t.id===parseInt(i.city));s&&r(s.name)}},[i.city_name,i.city]);const w=()=>{const s=new URLSearchParams;if(a.search&&s.append("search",a.search),a.city){const t=d.find(h=>h.id===a.city);t&&s.append("city_name",t.name)}else l&&s.append("city_name",l);a.specialty&&s.append("specialty",a.specialty),a.available_online&&s.append("available_online",a.available_online),a.sort&&a.sort!=="name"&&s.append("sort",a.sort),b.get(`/search?${s.toString()}`)},T=()=>{n({search:"",city:null,city_name:"",specialty:null,available_online:!1,sort:"name"}),r(""),b.get("/search")},D=(s,t)=>{s==null?(n({...a,city:null,city_name:""}),r("")):(n({...a,city:s,city_name:t?.children||""}),r(t?.children||""))},O=s=>{if(r(s),!s){n({...a,city:null,city_name:""});return}const t=d.find(h=>h.name.toLowerCase()===s.toLowerCase());n(t?{...a,city:t.id,city_name:s}:{...a,city:null,city_name:s})},k=async()=>{if(f(!0),!navigator.geolocation){x.info("Geolocation is not supported by your browser"),f(!1);return}navigator.geolocation.getCurrentPosition(async s=>{try{const{latitude:t,longitude:h}=s.coords,g=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${h}`)).json(),p=g.address?.city||g.address?.town||g.address?.village||g.address?.state_district;if(p){const y=d.find(j=>j.name.toLowerCase()===p.toLowerCase());y?(n(j=>({...j,city:y.id,city_name:y.name})),r(y.name),x.success(`Location detected: ${y.name}`)):(n(j=>({...j,city:null,city_name:p})),r(p),x.success(`Location detected: ${p}`))}}catch(t){console.error("Error getting location name:",t),x.error("Could not detect your city")}finally{f(!1)}},s=>{console.error("Geolocation error:",s),s.code===s.PERMISSION_DENIED?x.warning("Location access denied. Please select city manually."):x.error("Could not detect your location"),f(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"Search Doctors"}),e.jsx(A,{auth:$}),e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx(P,{level:2,className:"mb-6",children:"Find Doctors"}),e.jsxs(N,{className:"mb-6",children:[e.jsxs(_,{gutter:[16,16],children:[e.jsx(c,{xs:24,md:8,children:e.jsx(W,{size:"large",placeholder:"Search by name, specialty...",prefix:e.jsx(R,{}),value:a.search,onChange:s=>n({...a,search:s.target.value}),onPressEnter:w})}),e.jsxs(c,{xs:24,md:5,children:[e.jsx(o,{size:"large",showSearch:!0,placeholder:e.jsxs("span",{children:[e.jsx(v,{})," ",S?"Detecting...":"Select or type city"]}),className:"w-full",value:a.city,onChange:D,onSearch:O,allowClear:!0,onClear:()=>{r(""),n({...a,city:null,city_name:""})},filterOption:(s,t)=>(t?.children??"").toLowerCase().includes(s.toLowerCase()),dropdownRender:s=>e.jsxs(e.Fragment,{children:[s,l&&!a.city&&e.jsx("div",{className:"px-3 py-2 border-t text-center bg-blue-50",children:e.jsxs("div",{className:"text-xs text-blue-700",children:[e.jsx(v,{})," Will search for: ",e.jsxs("strong",{children:['"',l,'"']})]})})]}),notFoundContent:e.jsxs("div",{className:"text-center py-2",children:[e.jsx("p",{children:"No matching city in list"}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Current: ",e.jsx("strong",{children:l})]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Will use this city for search"})]})]}),suffixIcon:S?e.jsx(L,{spin:!0}):e.jsx(u,{type:"link",size:"small",icon:e.jsx(L,{}),onClick:s=>{s.stopPropagation(),k()},title:"Detect my location",className:"p-0"}),children:d.map(s=>e.jsx(o.Option,{value:s.id,children:s.name},s.id))}),l&&!a.city&&e.jsxs("div",{className:"text-xs text-blue-600 mt-1",children:[e.jsx(v,{})," Searching in: ",e.jsx("strong",{children:l})]})]}),e.jsx(c,{xs:24,md:5,children:e.jsx(o,{size:"large",placeholder:"Select Specialty",className:"w-full",value:a.specialty,onChange:s=>n({...a,specialty:s}),allowClear:!0,children:z.map(s=>e.jsx(o.Option,{value:s.id,children:s.name},s.id))})}),e.jsx(c,{xs:24,md:3,children:e.jsxs(o,{size:"large",placeholder:"Sort",className:"w-full",value:a.sort,onChange:s=>n({...a,sort:s}),children:[e.jsx(o.Option,{value:"name",children:"Name"}),e.jsx(o.Option,{value:"experience",children:"Experience"}),e.jsx(o.Option,{value:"fee",children:"Fee"})]})}),e.jsx(c,{xs:24,md:3,children:e.jsxs(u,{type:"primary",size:"large",block:!0,onClick:w,children:[e.jsx(R,{})," Search"]})})]}),e.jsx(_,{className:"mt-4",children:e.jsx(c,{children:e.jsx(u,{onClick:T,children:"Reset Filters"})})})]}),m.data.length===0?e.jsx(N,{children:e.jsx(E,{description:"No doctors found. Try adjusting your search criteria.",image:E.PRESENTED_IMAGE_SIMPLE})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 text-gray-600",children:["Found ",m.total," doctors"]}),e.jsx(_,{gutter:[16,16],children:m.data.map(s=>e.jsx(c,{xs:24,children:e.jsx(N,{hoverable:!0,children:e.jsxs(_,{gutter:16,children:[e.jsx(c,{xs:24,sm:6,md:4,children:s.image?e.jsx(F,{size:120,src:s.image}):e.jsx(F,{size:120,icon:e.jsx(B,{})})}),e.jsxs(c,{xs:24,sm:18,md:20,children:[e.jsx("div",{className:"flex justify-between",children:e.jsxs("div",{children:[e.jsx(P,{level:4,className:"mb-2",children:s.name}),e.jsxs("div",{className:"mb-2",children:[e.jsx(I,{color:"blue",icon:e.jsx(V,{}),children:s.specialty}),s.is_available_online&&e.jsx(I,{color:"green",children:"Online Consultation"})]}),s.experience_years&&e.jsxs("div",{className:"text-gray-600 mb-1",children:["Experience: ",s.experience_years," years"]}),s.consultation_fee&&e.jsxs("div",{className:"text-gray-600 mb-1",children:["Fee: â‚¹",s.consultation_fee]}),e.jsxs("div",{className:"text-gray-600 mb-2",children:[e.jsx(v,{})," ",s.cities.map(t=>t.name).join(", ")]}),e.jsx("div",{className:"text-gray-700 mb-3",children:s.bio})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{href:`/doctors/${s.id}`,children:e.jsx(u,{type:"primary",children:"View Full Profile"})}),s.website&&e.jsx(u,{icon:e.jsx(q,{}),href:s.website,target:"_blank",children:"Website"})]})]})]})})},s.id))}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsx(J,{current:m.current_page,total:m.total,pageSize:m.per_page,onChange:s=>{const t=new URLSearchParams(window.location.search);t.set("page",s),b.get(`/search?${t.toString()}`)},showSizeChanger:!1})})]})]})}),e.jsx(G,{})]})}export{$e as default};
